<%
  url = blocks_path(type: 'text')
  url = block_path(type: 'text', id: @block.id) if @block.persisted?
%>

<%= simple_form_for(@block, as: :block, url: url, remote: true, :html => { multipart: true }) do |f| %>

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <h4 class="modal-title"><%= @block.class.name.humanize %></h4>
  </div>

  <div class="modal-body">
    <%= f.input :body, as: 'text', input_html: { rows: 10 },
                 hint: 'Text can be formatted with <a href="http://markdown-here.com/livedemo.html">Markdown</a>.'.html_safe %>

    <% if @block.persisted? && @block.attachments.present? %>
      <div class="form-group">
        <%= f.label 'Image' %>
        <p class="form-control-static">
          <% @block.attachments.each do |attachment| %>
            <img src="<%= attachment.upload.url %>" class="img-responsive" width="100">
            <a href="<%= block_attachment_path(@block, attachment) %>" class="btn" data-method="delete" data-confirm="Are you sure you want to delete this image?">Delete
            </a>
          <% end %>
        </p>
      </div>
    <% else %>
      <div class="form-group">
        <label class="control-label">Image</label>
        <div id="dropzone-wrapper" class="dropzone"></div>
        <div id="dropzone-previews"></div>
      </div>
    <% end %>

    <%= f.input :layout, collection: ['image-left', 'image-right'] %>
  </div>

  <div class="modal-footer">
    <%= f.button :submit, class: 'btn btn-success' %>
  </div>

<% end %>

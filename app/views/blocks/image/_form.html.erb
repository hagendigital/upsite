<%
url = blocks_path(type: 'image')
url = block_path(type: 'image', id: @block.id) if @block.persisted?
%>

<div class="modal-header">
  <button type="button" class="close" data-dismiss="modal">&times;</button>
  <h4 class="modal-title"><%= @block.new_record? ? 'Add' : 'Edit' %> Image</h4>
</div>

<% if @block.new_record? %>
  <ul class="modal-nav nav nav-tabs">
    <li class="active">
      <a href="#upload" data-toggle="tab">Upload image</a>
    </li>
    <li>
      <a href="#web" data-toggle="tab">Add image from web</a>
    </li>
  </ul>
<% end %>

<div class="tab-content">

  <div id="upload" class="tab-pane <%= 'active' if @block.new_record? || @block.attachments.present? %>">
    <%= simple_form_for(@block, as: :block, url: url, remote: true, html: { multipart: true }) do |f| %>
      <div class="modal-body">
        <% if @block.new_record? %>
          <div class="form-group">
            <label class="control-label">Upload image</label>
            <ul class="list-group">
              <li class="list-group-item hidden">
                <p class="progress-status">Uploading...</p>
                <div class="progress">
                  <div class="progress-bar progress-bar-success" style="width: 20%;"></div>
                </div>
              </li>
              <li class="list-group-item">
                <a href="#" class="btn btn-success fileinput-button">
                  <i class="fa fa-lg fa-cloud-upload"></i>&nbsp;
                  <span>Select file</span>
                  <%= f.file_field 'attachments_attributes[0][upload]',
                    accept: '.jpg, .jpeg, .png, .gif',
                    data: { upload: true } %>
                </a>
              </li>
            </ul>
          </div>
        <% else %>
          <%= f.input :title, label: 'Caption' %>
          <%= f.input :link_url, label: 'Go to this link when clicking the image', placeholder: 'http://' %>
        <% end %>
      </div>
      <div class="modal-footer">
        <%= f.button :submit, class: 'btn btn-success', disabled: @block.new_record? %>
      </div>
    <% end %>
  </div>

  <div id="web" class="tab-pane <%= 'active' if @block.embed_url.present? %>">
    <%= simple_form_for(@block, as: :block, url: url, remote: true, html: { multipart: true }) do |f| %>
      <div class="modal-body">
        <%= f.input :embed_url, label: 'Image link', placeholder: 'instagram.com / imgur.com / giphy.com / etc.' %>
      </div>
      <div class="modal-footer">
        <%= f.button :submit, class: 'btn btn-success' %>
      </div>
    <% end %>
  </div>

</div>
